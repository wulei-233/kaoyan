# 数据库设计

​	

数据库设计的目标是为用户和各种应用系统提供一个**信息基础设施**和**高效率的运行环境** 。

高效率的运行环境？
    ：数据库数据的**存取**效率高
    ：数据库存储**空间的利用率**高
    ：数据库系统**运行管理**的效率高

###  数据库设计的特点

1. 数据库建设的基本规律：三分技术，七分管理，十二分基础数据


2. 结构（数据）设计和行为（处理）设计相结合 

### 数据库设计方法

手工试凑法

规范设计法

​	：手工设计方法
​    ：基本思想
​    	：过程迭代和逐步求精
​    	：典型方法
​    **新奥尔良**（New Orleans）方法
​    基于**E-R模型**的数据库设计方法
​    **3NF**（第三范式）的设计方法
​    **面向对象**的数据库设计方法
​    统一建模语言（**UML**）方法

### 数据库设计的基本步骤

数据库设计分6个阶段：（每个阶段都做了什么）
**需求分析**：是否做得充分与准确，决定了构建数据库的速度和质量
**概念结构设计**：通过对用户需求进行综合、归纳与抽象，形成一个独立于具体数据库管理系统的概念模型
**逻辑结构设计**：将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化
**物理结构设计**：为逻辑数据结构选取一个最适合应用环境的物理结构，包括存储结构和存取方法
**数据库实施**：根据逻辑设计和物理设计的结果构建数据库，编写与调试应用程序，组织数据入库并进行试运行
**数据库运行和维护** ：经过试运行后即可投入正式运行，在运行过程中必须不断对其进行评估、调整与修改

**需求分析**和**概念设计**独立于任何数据库管理系统 
**逻辑设计**和**物理设计**与选用的数据库管理系统密切相关

![image-20240228202649410](C:\Users\10263\AppData\Roaming\Typora\typora-user-images\image-20240228202649410.png)

参加数据库设计的人员

​	：系统分析人员和数据库设计人员

​	：数据库管理员和用户代表

​	：数据库管理员和用户代表

![image-20240228204130817](C:\Users\10263\AppData\Roaming\Typora\typora-user-images\image-20240228204130817.png)





### 数据库设计过程中的各级模式

![image-20240228204408996](C:\Users\10263\AppData\Roaming\Typora\typora-user-images\image-20240228204408996.png)



## 需求分析

#### 需求分析的任务

​	需求分析就是分析用户的要求

​	：是设计数据库的起点

​	：结果是否准确地反映了用户的实际要求，将直接影响到后面各个阶段的设计，并影响到设计结果是否合理和实用

​	调查的重点是“数据”和“处理”，获得用户对数据库的要求

（1）信息要求

（2）处理要求

（3）安全性与完整性要求

#### 需求分析的方法

分析方法：

==结构化分析方法==（Structured Analysis，简称SA方法）
	：SA方法从最上层的系统组织机构入手
	：采用自顶向下、逐层分解的方式分析系统

![image-20240228210258543](C:\Users\10263\AppData\Roaming\Typora\typora-user-images\image-20240228210258543.png)



#### ==数据字典==

数据字典是关于数据库中**数据的描述**，即**元数据**，不是数据本身

数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善

数据字典是进行详细的**数据收集和数据分析**所获得的主要结果

注意：
和关系数据库管理系统中数据字典的区别和联系

数据字典的内容：
1.数据项
2.数据结构
3.数据流
4.数据存储
5.处理过程
 	：数据项是数据的最小组成单位
 	：若干个数据项可以组成一个数据结构
 	：数据字典通过对**数据项和数据结构**的定义来描述**数据流、数据存储**的逻辑内容



数据项？

数据项是不可再分的数据单位

数据项描述={
	数据项名,
	数据项含义说明,
	别名,
	数据类型,
	长度,
	取值范围,
	取值含义,
	与其他数据项的逻辑关系,
	数据项之间的联系
}

##### 数据结构？

数据结构反映了数据之间的组合关系。

一个数据结构可以由若干个数据项组成，也可以由若干个数据结构组成，或由若干个数据项和数据结构混合组成。

数据结构描述={
	数据结构名，
	含义说明，
	组成:{数据项或数据结构}
}



##### 数据流？

数据流是数据结构在系统内传输的路径。

数据流描述={
	数据流名,
	说明,
	数据流来源,
    数据流去向,
    组成:{数据结构},
    平均流量,
    高峰期流量
}

数据流来源：说明该数据流来自哪个过程

数据流去向：说明该数据流将到哪个过程去

平均流量：在单位时间（每天、每周、每月等）里的传输次数

高峰期流量：在高峰时期的数据流量

##### 数据存储？

数据存储是数据结构停留或保存的地方，也是数据流的**来源和去向**之一。

数据存储描述={
	数据存储名,
	说明,
	编号,
	输入的数据流 ,
	输出的数据流,
    组成:{数据结构},
    数据量,
    存取频度,
    存取方式
}

存取频度：每小时、每天或每周存取次数，每次存取的数据量等信息 
存取方法：批**处理** / 联机处理；**检索** / 更新；顺序检索 / 随机检索
输入的数据流：数据来源
输出的数据流：数据去向

##### 处理过程？

处理过程的具体处理逻辑一般用判定表或判定树来描述。

数据字典中只需要描述处理过程的说明性信息

处理过程描述={
	处理过程名,
	说明,
	输入:{数据流},   
    输出:{数据流},
    处理:{简要说明}
}
简要说明：说明该处理过程的功能及处理要求
	：功能：该处理过程用来做什么
处理要求：处理频度要求，如单位时间里处理多少事务，多少数据量、响应时间要求等
	：处理要求是后面物理设计的输入及性能评价的标准

**第一阶段**收集的基础数据（用**数据字典**来表达）是下一步进行**概念设计的基础**。

强调两点 ：
（1）设计人员应充分考虑到可能的扩充和改变，使设计易于更改，系统易于扩充 
（2）必须强调用户的参与



## 概念结构设计



#### 概念模型

将需求分析得到的用户需求抽象为信息结构（即概念模型）的过程就是概念结构设计

概念模型的特点
（1）能真实、充分地反映现实世界，是现实世界的一个真
         实模型。
（2）易于理解，从而可以用它和不熟悉计算机的用户交换
          意见。
（3）易于更改，当应用环境和应用要求改变时，容易对概
         念模型修改和扩充。
（4）易于向关系、网状、层次等各种数据模型转换

描述概念模型的工具：E-R模型

#### ==E-R模型==

1. 实体之间的联系
（1）两个**实体型**之间的联系：
		①一对一联系（1∶1）
		如果对于**实体集**A中的每一个实体，实体集B中至多有一个（也可以没有）实体与之联系，反之亦然，则称	实体集A与实体集B具有一对一联系，记为1∶1。
		②一对多联系（1∶n）
		如果对于**实体集**A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一	个实体，实体集A中至多只有一个实体与之联系，则称实体集A与实体集B有一对多联系，记为1∶n。
		③多对多联系（m∶n）
		如果对于实体集A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一个实体，实体集A中也有m个实体（m≥0）与之联系，则称实体集A与实体集B具有多对多联系，记m∶n。
	
	（2）两个以上的实体型之间的联系
	一般地，两个以上的实体型之间也存在着一对一、一对多、多对多联系。
	对于课程、教师与参考书3个实体型，如果一门课程可以有若干个教师讲授，使用若干本参考书，而每一个教师只讲授一门课程，每一本参考书只供一门课程使用，则课程与教师、参考书之间的联系是一对多的，
	
	（3）单个实体型内的联系
	同一个实体集内的各实体之间也可以存在一对一、一对多、多对多的联系。
	例如，职工实体型内部具有领导与被领导的联系，即某一职工（干部）“领导”若干名职工，而一个职工仅被另外一个职工直接领导，因此这是一对多的联系.

**联系的度**：参与联系的实体型的数目

#### ==概念结构设计==

​	1.实体与属性的划分原则：

​	为了简化E-R图的处置，现实世界的事物能作为属性对待的，尽量作为属性对待。

​	两条准则：

​	（1）作为属性，不能再具有需要描述的性质。属性必须是不可分的数据项，不能包含其他属性。

​	（2）属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系。

​	2. E-R图的集成

​	E-R图的集成一般需要分两步：
 	1）合并。解决各分E-R图之间的冲突，将分E-R图合并起来生成初步E-R图。
 	2）修改和重构。消除不必要的冗余，生成基本E-R图。









##  逻辑结构设计

逻辑结构设计的任务：把概念结构设计阶段设计好的基本E-R图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构

####  ==E-R图向关系模型的转换==

​	转换内容
​	：E-R图由实体型、实体的属性和实体型之间的联系三个要素组成
​	：关系模型的**逻辑结构**是一组**关系模式的集合**
​	：将E-R图转换为关系模型：将实体型、实体的属性和实体型之间的联系转化为关系模式

​	转换原则

​	1. 一个实体型转换为一个关系模式。

​		关系的属性：实体的属性

​		关系的码：实体的码

​	2. 实体型间的联系有以下==不同情况==（1：1，1：n，n：m）

​	（1） 一个**1:1**联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并。

​		① 转换为一个独立的关系模式
​		关系的属性：与该联系相连的各实体的码以及联系本身的属性
​		关系的候选码：每个实体的码均是该关系的候选码

​		②与某一端实体对应的关系模式合并
​		合并后关系的属性：加入对应关系的码和联系本身的属性
​		合并后关系的码：不变

​	（2）一个**1:n**联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并。
​		①转换为一个独立的关系模式
​		关系的属性：与该联系相连的各实体的码以及联系本身的属性
​		关系的码：n端实体的码

​		②与n端对应的关系模式合并
​		合并后关系的属性：在n端关系中加入1端关系的码和联系本身的属性
​		合并后关系的码：不变
​		：可以减少系统中的关系个数，一般情况下更倾向于采用这种方法

​	（3）一个**m:n**联系转换为一个关系模式
​		关系的属性：与该联系相连的各实体的码以及联系本身的属性
​		关系的码：各实体码的组合

​	（4）三个或三个以上实体间的**一个多元联系**转换为一个关系模式。
​		关系的属性：与该多元联系相连的各实体的码以及联系本身的属性
​		关系的码：各实体码的组合

​	（5）具有**相同码**的关系模式可**合并**
​		目的：减少系统中的关系个数
​		合并方法：
​		 将其中一个关系模式的全部属性加入到另一个关系模式中
 		然后去掉其中的同义属性（可能同名也可能不同名）
 		适当调整属性的次序



####  数据模型的优化

​	数据库逻辑设计的结果不是唯一的。关系数据模型的优化通常以规范化理论为指导。

​	优化数据模型的方法:
​	（1）确定数据依赖
​		：按需求分析阶段所得到的语义，分别写出每个关系模式内部各属性之间的数据依赖以及不同关系模式属性之间数据依赖。
​	（2）对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系。

​	（3）按照数据依赖的理论对关系模式进行分析，考察是否存在部分函数依赖、传递函数依赖、多值依赖等，确定各关系模式分别属于第几范式。
​	（4）按照需求分析阶段得到的各种应用对数据处理的要求，分析对于这样的应用环境这些模式是否合适，确定是否要对它们进行合并或分解。

：并不是规范化程度越高的关系就越优：连接会变多，连接很慢

​	（5）对关系模式进行必要分解，提高数据操作效率和存储空间的利用率。

​	常用分解方法
​	：==水平分解==
​	：==垂直分解==

#### 设计用户子模式（视图）

定义用户外模式时应该更注重考虑用户的习惯与方便。包括三个方面：

（1）使用更符合用户习惯的**别名**
	：合并各分E-R图曾做了消除命名冲突的工作，以使数据库系统中同一关系和属性具有唯一的名字。这在设计数据库整体结构时是非常必要的。
	：用视图机制可以在设计用户视图时可以重新定义某些属性名，使其与用户习惯一致，以方便使用。

（2）针对不同级别的用户定义不同的视图，以保证系统的安全性。
	：假设有关系模式产品（产品号，产品名，规格，单价，生产车间，生产负责人，产品成本，产品合格率，质量等级），可以在产品关系上建立两个视图：
		：为一般顾客建立视图：产品1（产品号，产品名，规格，单价）
		：为产品销售部门建立视图：产品2（产品号，产品名，规格，单价，车间，生产负责人）

（3）简化用户对系统的使用
	：如果某些局部应用中经常要使用某些很复杂的查询，为了方便用户，可以将这些复杂查询定义为视图。

### 物理结构设计

什么是数据库的物理设计？**（概念解释）**

：数据库在物理设备上的存储结构与存取方法称为数据库的物理结构，它依赖于选定的数据库管理系统。

：一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程，就是数据库的物理设计。

数据库物理设计的**步骤**

：确定数据库的物理结构
在关系数据库中主要指存取方法和存储结构;
：对物理结构进行评价
评价的重点是时间和空间效率
 ：若 评价结果满足原设计要求，则可进入到物理实施阶段。否则，就需要重新设计或修改物理结构，有时甚至要返回逻辑设计阶段修改数据模型。

#### 数据库物理设计的内容和方法

设计物理数据库结构的准备工作:
	充分了解**应用环境**，详细分析要运行的事务，以获得选择物理数据库设计所需参数。
	充分了解所用关系型数据库管理系统的**内部特征**，特别是系统提供的**存取方法和存储结构**。

选择物理数据库设计所需参数:

###### 数据库查询事务

- 查询的关系
- 查询条件所涉及的属性
- 连接条件所涉及的属性
- 查询的投影属性

###### 数据更新事务

- 被更新的关系
- 每个关系上的更新操作条件所涉及的属性
- 修改操作要改变的属性值

###### 每个事务在各关系上运行的频率和性能要求



关系数据库物理设计的内容

- 为关系模式选择存取方法（建立**存取路径**）

- 设计关系、索引等数据库文件的**物理存储结构**

关系模式存取方法选择

- 数据库系统是多用户共享的系统，对**同一个关系**要建立**多条存取路径**才能满足多用户的多种应用要求。

- 物理结构设计的任务之一是根据关系数据库管理系统支持的存取方法确定选择哪些存取方法。

数据库管理系统**常用存取方法**
1. B+树索引存取方法
2. Hash索引存取方法

3. 聚簇存取方法

选择索引存取方法的**主要内容**

根据应用要求确定

选择索引存取方法的一般规则:

- 如果一个（或一组）属性经常在查询条件中出现，则考虑在这个（或这组）属性上建立索引（或组合索引）
- 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引
- 如果一个（或一组）属性经常在连接操作的连接条件中 出现，则考虑在这个（或这组）属性上建立索引

索引会有额外开销：维护/查找

2. HASH存取方法的选择

   如果一个关系的属性主要出现在**等值连接条件**中或主要出现在**等值比较选择条件**中，而且满足下列两个条件之一
   	：该关系的大小可预知，而且不变； 
   	：该关系的大小动态改变，但所选用的数据库管理系统提供了动态Hash存取方法。

3. 聚簇存取方法的选择

   （什么是聚族？？）

   - 为了提高某个属性（或属性组）的查询速度，把这个或这些**属性（称为聚簇码）上具有相同值**的元组集中存放在**连续的物理块**中称为聚簇。
   - 该属性（或属性组）称为聚簇码（cluster key）
   - 许多关系型数据库管理系统都提供了聚簇功能
   - **聚簇存放**与**聚簇索引**的区别

聚簇索引：

- 建立聚簇索引后，基表中数据也需要按指定的聚簇属性值的**升序或降序**存放。也即聚簇索引的**索引项顺序与表中元组的物理顺序一致**。
- 在**一个基本表**上最多**只能建立一个**聚簇索引
- 聚簇索引的适用条件
  - 很少对基表进行增删操作
  - 很少对其中的变长列进行修改操作 

聚簇的用途：对于某些类型的查询，可以提高查询效率

	1. 大大提高按聚簇属性进行查询的效率
	2. 节省存储空间：聚簇以后，聚簇码相同的元组集中在一起了，因而聚簇码值不必在每个元组中重复存储，只要在一组中存一次就了。

聚簇的局限性：

1. 聚簇只能提高某些特定应用的性能

2. 建立与维护聚簇的开销相当大

聚簇的适用范围：

- 既适用于**单个关系**独立聚簇，也适用于**多个关系组合**聚簇
- 当通过**聚簇码**进行访问或连接是该关系的主要应用，与聚簇码无关的其他访问很少或者是次要的时，可以使用聚簇
  - 尤其当SQL语句中包含有与聚簇码有关的ORDER BY, GROUP BY, UNION, DISTINCT等子句或短语时，使用聚簇特别有利，可以省去或减化对结果集的排序操作

###### 选择聚簇存取方法

​	设计候选聚簇:

  （1）常在一起进行连接操作的关系可以建立**组合聚簇**

  （2）如果一个关系的一组属性经常出现在相等比较条件中，则该单个关系可建立聚簇；

  （3）如果一个关系的一个（或一组）属性上的值重复率很高，则此单个关系可建立聚簇。

​	检查候选聚簇中的关系，取消其中不必要的关系:

（1）从聚簇中删除经常进行全表扫描的关系

（2）从聚簇中删除更新操作远多于连接操作的关系

（3）从聚簇中删除重复出现的关系

##### 确定数据库的存储结构

确定数据库物理结构主要指确定数据的**存放位置**和**存储结构**

​	包括：确定关系、索引、聚簇、日志、备份等的存储安排和存储结构，确定系统配置等。

确定数据的存放位置和存储结构要综合考虑存取时间、存储空间利用率和维护代价3个方面的因素。

基本原则:

- 易变部分与稳定部分分开存放
- 经常存取部分与存取频率较低部分分开存放

##### 评价物理结构

​	评价方法:

- 定量估算各种方案
  - 存储空间
  - 存取时间
  - 维护代价
- 对估算结果进行权衡、比较，选择出一个较优的合理的物理结构。



### 数据库的实施和维护



##### 数据的载入和应用程序的调试

数据装载方法

- 人工方法
- 计算机辅助数据入库

##### 数据库的试运行

- 功能测试：实际运行应用程序，执行对数据库的各种操作，测试应用程序的各种功能。

- **性能**测试：测量系统的性能指标，分析是否符合设计目标。

数据库**性能**指标的测量:

​	数据库物理设计阶段在评价数据库结构估算时间、空间指标时，作了许多简化和假设，忽略了许多次要因素，因此结果必然很粗糙。

​	数据库试运行则是要实际测量系统的各种性能指标（不仅是时间、空间指标），如果结果不符合设计目标，则需要返回物理设计阶段，调整物理结构，修改参数；有时甚至需要返回逻辑设计阶段，调整逻辑结构

数据的**分期入库**: (怕你重构开销大)

数据库的**转储和恢复**

##### 数据库的运行和维护

在数据库运行阶段，对数据库经常性的维护工作主要是由数据库管理员完成的，包括：

1. 数据库的转储和恢复

2. 数据库的安全性、完整性控制

3. 数据库性能的监督、分析和改进

4. 数据库的重组织与重构造

## 小结

数据库各级模式的形成
需求分析阶段：综合各个用户的应用需求（现实世界的需求）。
概念设计阶段：概念模式（信息世界模型），用E-R图来描述。
逻辑设计阶段：逻辑模式、外模式。
物理设计阶段：内模式。

**概念结构设计**
E-R模型的基本概念和图示方法
E-R模型的设计
把E-R模型转换为关系模型的方法

**逻辑模式**：在逻辑设计阶段将E-R图转换成具体的数据库产品支持的数据模型如关系模型，形成数据库**逻辑模式**

**外模式：**然后根据用户处理的要求，安全性的考虑，在基本表的基础上再建立必要的视图，形成数据的**外模式**

**内模式**：在物理设计阶段根据DBMS特点和处理的需要，进行物理存储安排，设计索引，形成数据库**内模式**