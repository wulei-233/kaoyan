# 数据库编程

### 存储过程和函数

#### ==存储过程==

###### 过程化SQL块类型：

**命名块**：**编译后**保存在数据库中，可以被反复调用，运行速度较快，**过程和函数**是命名块  

**匿名块**：**每次**执行时都要进行**编译**，它**不能**被存储到数据库中，也**不能**在其他过程化SQL块中调用 

**存储过程**：由过程化SQL语句书写的过程，经编译和优化后存储在数据库服务器中，使用时只要调用即可。

1. 存储过程的优点 

   （1）运行效率高
   （2）降低了客户机和服务器之间的通信量	
   （3）方便实施企业规则

2. ==存储过程的用户接口== 

   （1）创建存储过程 ：

   ```sql
   CREATE OR REPLACE PROCEDURE 过程名([参数1,参数2,...]) AS <过程化SQL块>；
   
   过程名：数据库服务器合法的对象标识
   参数列表：用名字来标识调用时给出的参数值，必须指定值的数据类型。参数也可以定义输入参数、输出参数或输入/输出参数，默认为输入参数
   过程体：是一个<过程化SQL块>，包括声明部分和可执行语句部分 
   
   ```

   （2）执行存储过程 

   ```sql
    CALL/PERFORM  PROCEDURE 过程名([参数1,参数2,...])；
   
   使用CALL或者PERFORM等方式激活存储过程的执行
   在过程化SQL中，数据库服务器支持在过程体中调用其他存储过程
   ```

   （3）修改存储过程

   ```sql
   ALTER PROCEDURE 过程名1  RENAME TO 过程名2;
   ```

   （4）删除存储过程

	```sql
	DROP  PROCEDURE 过程名()；
	```



### ==函数==

函数和存储过程的异同:

- 同：都是持久性存储模块
- 异：函数必须指定返回的类型

1. 函数的定义语句格式

```sql
CREATE OR REPLACE FUNCTION 函数名 ([参数1,参数2,…]) RETURNS <类型>  AS <过程化SQL块>;
```

2. 函数的执行语句格式

```sql
CALL/SELECT 函数名 ([参数1,参数2,…]);   
```

3. 修改函数
   重命名:

   ```sql
   ALTER FUNCTION 过程名1 RENAME TO 过程名2;
   ```

   重新编译:

   ```sql
   ALTER FUNCTION 过程名 COMPILE;
   ```

   